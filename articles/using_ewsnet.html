<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EWSmethods">
<title>Using EWSNet • EWSmethods</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using EWSNet">
<meta property="og:description" content="EWSmethods">
<meta property="og:image" content="https://duncanobrien.github.io/EWSmethods/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EWSmethods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ews_assessments.html">Performing Early Warning Signal Assessments</a>
    <a class="dropdown-item" href="../articles/resilience_measures.html">Alternative Resilience Measures</a>
    <a class="dropdown-item" href="../articles/using_ewsnet.html">Using EWSNet</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/duncanobrienn" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/duncanobrien/EWSmethods/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Using EWSNet</h1>
                        <h4 data-toc-skip class="author">Duncan
O’Brien</h4>
            
            <h4 data-toc-skip class="date">2023-04-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/duncanobrien/EWSmethods/blob/HEAD/vignettes/using_ewsnet.Rmd" class="external-link"><code>vignettes/using_ewsnet.Rmd</code></a></small>
      <div class="d-none name"><code>using_ewsnet.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="about-this-tutorial">About this tutorial<a class="anchor" aria-label="anchor" href="#about-this-tutorial"></a>
</h2>
<p>This tutorial introduces how to interface with
<strong>EWSNet</strong>, a machine learning model trained to predict
critical transitions, tipping points, and regime shifts (Deb <em>et
al.</em> 2022). We will only focus on how to set up your R session to
interact with EWSNet and how to interpret the output rather than the
theory and mathematics underlying the model. If you are interest in
those details, please refer to the EWSNet specific <a href="https://ewsnet.github.io" class="external-link">website and documentation</a> or the
associated <a href="https://royalsocietypublishing.org/doi/10.1098/rsos.211475" class="external-link">publication</a>.</p>
<p><strong>NOTE</strong> This version of EWSNet differs from that
published by Deb <em>et al.</em> (2022) in that is has been retrained
using a range of time series lengths (minimum = 15). This improves the
accuracy of EWSNet over a range of time series lengths but we recommend
that the minimum length to be tested should be 15 data points.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co">#to ensure reproducible data</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/duncanobrien/EWSmethods" class="external-link">EWSmethods</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<p>As EWSNet has been written and developed in Python, for R to interact
with it, we need to exploit the <code>reticulate</code> <a href="https://rstudio.github.io/reticulate/" class="external-link">R package</a>.
<code>reticulate</code> provides the tools to run Python code in R and
transfer objects between the two languages but tends to run much
smoother in RStudio rather than base R. It is therefore recommended that
you use the <a href="https://www.rstudio.com/products/rstudio/download/" class="external-link">RStudio
IDE</a> when using the EWSNet portion of <code>EWSmethods</code>.</p>
<p>The following sections will show how to setup and run EWSNet in
<code>EWSmethods</code> before troubleshooting a few common errors
stemming from the Python-<code>reticulate</code>-R interface.</p>
<p><br></p>
<div class="section level3">
<h3 id="initialising-ewsnet">1. Initialising <strong>EWSNet</strong><a class="anchor" aria-label="anchor" href="#initialising-ewsnet"></a>
</h3>
<p>Rather than requiring the user to learn <code>reticulate</code> and
setup the R session themselves, <code>EWSmethods</code> provides a
single function capable of checking your machine for Python, installing
it if it’s not found (along with the critical packages), creating a new
Python environment to hold these packages, and then activating that
environment when ready. To prevent the user accidentally installing
Python or packages, the function does require confirmation inputs from
the user and so needs to be run <strong>at the start of any new R
session</strong>.</p>
<p>For example, to create a new Python environment called
<code>"EWSNET_env"</code> and install Python, the function would be
written as below. The environment name (<code>"EWSNET_env"</code>) will
be critical to running the later functions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#prepares your session using 'reticulate' and asks to install Anaconda (if no appropriate Python found) and/or a Python environment before activating that environment with the necessary Python packages</span></span>
<span><span class="fu"><a href="../reference/EWSNET_init.html">ewsnet_init</a></span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"EWSNET_env"</span>, pip_ignore_installed <span class="op">=</span> <span class="cn">FALSE</span>,  conda_refresh <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>If successful, you will have had to input <code>"y"</code> to allow
<code>EWSmethods</code> to download and activate the Python environment
and now see the message
<code>"EWSNET_env successfully found and activated. Necessary Python packages installed"</code>).
If not, please refer to the Troubleshooting section at the end of the
tutorial.</p>
<p>To double check the environment activation, you could use
<code>reticulate</code> functions to check first what environment is
active and second what Python packages have been loaded:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print which Python environment `EWSmethods` is using</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_config.html" class="external-link">py_config</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; python:         /usr/share/miniconda/envs/EWSNET_env/bin/python</span></span>
<span><span class="co">#&gt; libpython:      /usr/share/miniconda/envs/EWSNET_env/lib/libpython3.8.so</span></span>
<span><span class="co">#&gt; pythonhome:     /usr/share/miniconda/envs/EWSNET_env:/usr/share/miniconda/envs/EWSNET_env</span></span>
<span><span class="co">#&gt; version:        3.8.16 (default, Mar  2 2023, 03:21:46)  [GCC 11.2.0]</span></span>
<span><span class="co">#&gt; numpy:          /usr/share/miniconda/envs/EWSNET_env/lib/python3.8/site-packages/numpy</span></span>
<span><span class="co">#&gt; numpy_version:  1.23.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; NOTE: Python version was forced by use_python function</span></span>
<span></span>
<span><span class="co">#list all packages currently loaded in to "EWSNET_env"</span></span>
<span><span class="va">py_packages</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_list_packages.html" class="external-link">py_list_packages</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">py_packages</span><span class="op">)</span></span>
<span><span class="co">#&gt;         package version       requirement   channel</span></span>
<span><span class="co">#&gt; 1 _libgcc_mutex     0.1 _libgcc_mutex=0.1 pkgs/main</span></span>
<span><span class="co">#&gt; 2 _openmp_mutex     5.1 _openmp_mutex=5.1 pkgs/main</span></span>
<span><span class="co">#&gt; 3       absl-py   1.4.0     absl-py=1.4.0      pypi</span></span>
<span><span class="co">#&gt; 4     alabaster  0.7.13  alabaster=0.7.13      pypi</span></span>
<span><span class="co">#&gt; 5    astunparse   1.6.3  astunparse=1.6.3      pypi</span></span>
<span><span class="co">#&gt; 6         babel  2.12.1      babel=2.12.1      pypi</span></span></code></pre></div>
<p><code>EWSmethods</code> also does not come bundled with the necessary
model weights to make predictions. This is due the size of the weight
files being ~220 MB which is not appropriate for all users of the
package. To download these weights, we can use the
<code><a href="../reference/ewsnet_reset.html">ewsnet_reset()</a></code> function which can either remove
no-longer-needed weights or re/download from <a href="https://ewsnet.github.io" class="external-link">https://ewsnet.github.io</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ewsnet_reset.html">ewsnet_reset</a></span><span class="op">(</span>remove_weights <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>If successful, you will have had to input <code>"y"</code> to allow
<code>EWSmethods</code> to download the pretrained weights.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="predictions-from-ewsnet">2. Predictions from <strong>EWSNet</strong><a class="anchor" aria-label="anchor" href="#predictions-from-ewsnet"></a>
</h3>
<p>To give an example on how to use <code><a href="../reference/ewsnet_predict.html">ewsnet_predict()</a></code> we
need some test data. Here, we will use some random noise around a mean
of 0 which we expect to be predicted as
<code>"No Transition"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simTransComms"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pre_simTransComms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">simTransComms</span><span class="op">$</span><span class="va">community1</span>,<span class="va">time</span> <span class="op">&lt;</span> <span class="va">inflection_pt</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pre_simTransComms</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_ewsnet_files/figure-html/create_white_data-1.png" width="1050"></p>
<p>We then simply provide this vector to <code><a href="../reference/ewsnet_predict.html">ewsnet_predict()</a></code>
while also specifying the Python environment, the scaling of the data
and ensemble number (how many models to average the prediction
over).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ewsnet_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ewsnet_predict.html">ewsnet_predict</a></span><span class="op">(</span><span class="va">pre_simTransComms</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, scaling <span class="op">=</span> <span class="cn">TRUE</span>, ensemble <span class="op">=</span> <span class="fl">25</span>, envname <span class="op">=</span> <span class="st">"EWSNET_env"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ewsnet_prediction</span></span>
<span><span class="co">#&gt;                  pred no_trans_prob smooth_trans_prob critical_trans_prob</span></span>
<span><span class="co">#&gt; 1 Critical Transition       0.26739        0.04719289           0.6854172</span></span></code></pre></div>
<div class="section level4">
<h4 id="interpreting-ewsnet">Interpreting EWSNet<a class="anchor" aria-label="anchor" href="#interpreting-ewsnet"></a>
</h4>
<p>As with any machine learning model, interpreting prediction
probabilities is difficult. In EWSNet’s case, as three possible
predictions can be made - <em>No transition, Smooth transition, Critical
transition</em> - a chance prediction is one that is approximately 0.33
(1.0 divided by 3 is ~0.33).</p>
<p>Therefore any probability greater than 0.33 implies a stronger than
chance prediction and anything greater than 0.6 warrants serious
scrutiny.</p>
<p>Similarly, the real world manifestation of a Smooth or Critical
transition is unclear (Kefi <em>et al</em> 2013, Gsell <em>et al</em>
2016). EWSNet therefore considers a <code>"Smooth Transition"</code>
prediction to indicate a directional trend in the system whereas a
<code>"Critical Transition"</code> indicates a rapid non-linear change.
A <code>"No Transition"</code> prediction consequently suggests a stable
period.</p>
<p>The below figure visually depicts the models that have been used to
train these predictions and how those predictions relate to time series
data.</p>
<div class="figure">
<img src="figure_3.png" alt="Conceptual diagram of A) the type of transitions that EWSNet has been trained on and B) how those transitons can appear in real time series data" width="2016"><p class="caption">
Conceptual diagram of A) the type of transitions that EWSNet has been
trained on and B) how those transitons can appear in real time series
data
</p>
</div>
<p><br></p>
</div>
<div class="section level4">
<h4 id="predictions-through-time">Predictions through time<a class="anchor" aria-label="anchor" href="#predictions-through-time"></a>
</h4>
<p>An additional way to use EWSNet is to explore how predictions change
through time. By iteratively adding in new data, we can see how those
predictions evolve.</p>
<p>For example, using our test data, we could use this code to identify
transitions that may have happened in the past:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#define the range of indexes to test over</span></span>
<span><span class="va">expanding_range</span> <span class="op">&lt;-</span> <span class="fl">50</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pre_simTransComms</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#pre-define our out file</span></span>
<span><span class="va">expanding_ewsnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">expanding_range</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,ncol<span class="op">=</span><span class="fl">3</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cutoff_ind"</span>,<span class="st">"No transition"</span>,<span class="st">'Smooth'</span>,<span class="st">'Critical'</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#call `ewsnet_predict()` for each index </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">expanding_range</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> </span>
<span>  <span class="va">ews.tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ewsnet_predict.html">ewsnet_predict</a></span><span class="op">(</span><span class="va">pre_simTransComms</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">expanding_range</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="fl">3</span><span class="op">]</span>,scaling <span class="op">=</span> <span class="cn">TRUE</span>, ensemble <span class="op">=</span> <span class="fl">25</span>, envname <span class="op">=</span> <span class="st">"EWSNET_env"</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">expanding_ewsnet</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">expanding_range</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">ews.tmp</span><span class="op">$</span><span class="va">no_trans_prob</span>,<span class="va">ews.tmp</span><span class="op">$</span><span class="va">smooth_trans_prob</span>,<span class="va">ews.tmp</span><span class="op">$</span><span class="va">critical_trans_prob</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#plot the results</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">expanding_ewsnet</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">cutoff_ind</span>,names_to <span class="op">=</span> <span class="st">"Prediction"</span>,values_to <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">cutoff_ind</span>,y<span class="op">=</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">Prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Assessment index"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Prediction probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="expanding_ewsnet-1.png" width="1400"> Here we see how
prediction probabilities fluctuate with new data, with the trends in
probabilities also providing information on how the system has changed
over time.</p>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="finetuning-ewsnet">3. Finetuning EWSNet<a class="anchor" aria-label="anchor" href="#finetuning-ewsnet"></a>
</h3>
<p>In the circumstance where training data is available, it may be
preferable to finetune EWSNet. Finetuning alters the EWSNet model
weights based upon the training data in an attempt to improve
predictions. For example, the user could simulate their own collapsing
time series of the same length as their test data. EWSNet would then be
tuned to identify features specific to the time series of interest.</p>
<p>An example is given below using a mock data set matched to the same
length of <code>pre_simTransComms</code> - 191 data points.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pre_simTransComms</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pre_simTransComms</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>,mean<span class="op">=</span><span class="fl">20</span>,sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># create dummy data </span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">10</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># create labels. 0 = no transition, 1 = smooth transition, 2 = critical transition</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ewsnet_finetune.html">ewsnet_finetune</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, scaling <span class="op">=</span> <span class="cn">TRUE</span>, envname <span class="op">=</span> <span class="st">"EWSNET_env"</span><span class="op">)</span></span></code></pre></div>
<p>Each of the 25 scaled model weights have resultingly been finetuned
based upon the new training data. Calling
<code>ewsnet_predict(scaling = T)</code> will therefore use these new
weights.</p>
<p>In this example, as the training data has been randomly generated,
the prediction quality will decrease, however it goes to show how
weights can be updated/improved if new data comes available.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="resetting-ewsnet">4. Resetting EWSNet<a class="anchor" aria-label="anchor" href="#resetting-ewsnet"></a>
</h3>
<p>Following finetuning, it may be desirable to reset the model weights
to their default. Using the <code><a href="../reference/ewsnet_reset.html">ewsnet_reset()</a></code> function, the
user can direct <code>EWSmethods</code> to the path of the default
weights (these can be redownloaded from the <a href="https://github.com/sahilsid/ewsnet" class="external-link">EWSNet github</a>) which will
overwrite the current model weights stored by
<code>EWSmethods</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ewsnet_reset.html">ewsnet_reset</a></span><span class="op">(</span>remove_weights <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<p>You may want to remove Python downloads and environment setup by
<code>EWSmethods</code> and/or any downloaded EWSNet weights. You can
achieve this using <code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code> and the
<code>conda_refresh =</code> argument, and <code><a href="../reference/ewsnet_reset.html">ewsnet_reset()</a></code>
respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/EWSNET_init.html">ewsnet_init</a></span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"EWSNET_env"</span>,conda_refresh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># removes Python, its packages and the "EWSNET_env" environment</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ewsnet_reset.html">ewsnet_reset</a></span><span class="op">(</span>remove_weights <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># removes any downloaded EWSNet weights</span></span></code></pre></div>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="quick-reference">Quick reference<a class="anchor" aria-label="anchor" href="#quick-reference"></a>
</h2>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Function name</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code></td>
<td>Prepares the session to interface with Python. <em>Critical first
step</em>
</td>
</tr>
<tr class="even">
<td><code><a href="../reference/ewsnet_predict.html">ewsnet_predict()</a></code></td>
<td>Using the Python environment initialised by
<code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code>, builds the EWSNet model and makes
predictions from the user supplied time series</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/ewsnet_finetune.html">ewsnet_finetune()</a></code></td>
<td>Retrains the initial EWSNet model weights based upon new user
provided training data</td>
</tr>
<tr class="even">
<td><code><a href="../reference/ewsnet_reset.html">ewsnet_reset()</a></code></td>
<td>Overwrites the model weights with the default weights downloaded
from <a href="https://github.com/sahilsid/ewsnet" class="external-link">EWSNet github</a>
</td>
</tr>
</tbody>
</table>
<p>Greater detail on each function can be found at the <a href="https://duncanobrien.github.io/EWSmethods/reference/index.html">Reference</a>
page.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="reticulate-is-activating-a-different-environment-to-the-one-i-gave-to-ewsnet_init">1. <em><code>reticulate</code> is activating a different environment
to the one I gave to <code>ewsnet_init()</code></em><a class="anchor" aria-label="anchor" href="#reticulate-is-activating-a-different-environment-to-the-one-i-gave-to-ewsnet_init"></a>
</h3>
<p>This is the main error when using <code>EWSmethods</code>. The first
solution is to simply restart the R session and rerun
<code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code>. If <code>reticulate</code> is loaded before
<code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code> is run, then the default
<code>reticulate</code> environment <code>"r-reticulate"</code> is
activated instead of your EWSNet environment. Therefore ensure no
<code>reticulate</code> command or <code><a href="https://rstudio.github.io/reticulate/" class="external-link">library(reticulate)</a></code> is
run prior to <code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code>.</p>
<p>If the error remains and your RStudio version is &gt;=1.4, you may
need to edit your Python interpreter settings in RStudio’s preferences.
Go to Preferences -&gt; Python and untick “Automatically activate
project-level Python environments”. Then restart your R session and
rerun <code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code>.</p>
<p>The final solution we are aware of involves deactivating
<code>reticulate</code>’s default behaviour in your global R environment
settings. Running <code><a href="../reference/bypass_reticulate_autoinit.html">bypass_reticulate_autoinit()</a></code> will disable
<code>reticulate</code>’s ability to load a Python environment without a
user request. Restart your R session and rerun
<code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code> once ready.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="ewsnet_predict-is-returning-python-errors">2. <em><code>ewsnet_predict()</code> is returning Python
errors</em><a class="anchor" aria-label="anchor" href="#ewsnet_predict-is-returning-python-errors"></a>
</h3>
<p>These errors are extremely difficult to debug through R .
Fortunately, in our experience, such errors are legacies of previous
issues such as incorrect initialising of the Python environment, the
crashing of an R session, or killing of the running function. The error
is therefore often solved by restarting the R session and rerunning
<code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code>.</p>
<p>If the error remains, please submit a bug report <a href="https://github.com/duncanobrien/EWSmethods/issues" class="external-link">here</a>.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="i-want-to-uninstall-python-and-its-environments">3. <em>I want to uninstall Python and its environments</em><a class="anchor" aria-label="anchor" href="#i-want-to-uninstall-python-and-its-environments"></a>
</h3>
<p><code><a href="../reference/EWSNET_init.html">ewsnet_init()</a></code> provides the capabaility to do this using
the <code>conda_refresh =</code> argument:</p>
<p><code>ewsnet_init(envname = "envname",conda_refresh = TRUE)</code>.</p>
<p>This function will remove any downloaded Python versions, packages or
environments to allow a fresh install or permanent removal.</p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Deb S., Sidheekh S., Clements C.F., Krishnan N.C. &amp; Dutta P.S.
(2022) Machine learning methods trained on simple models can predict
critical transitions in complex natural systems. <em>Royal Society Open
Science</em>, 9, 211475. <a href="https://royalsocietypublishing.org/doi/10.1098/rsos.211475" class="external-link">doi:10.1098/rsos.211475</a></p>
<p>Gsell AS, Scharfenberger U, Özkundakci D, Walters A, Hansson LA,
Janssen AB, Nõges P, Reid PC, Schindler DE, Van Donk E, Dakos V &amp;
Adrian R. (2016) Evaluating early-warning indicators of critical
transitions in natural aquatic ecosystems. <em>PNAS</em>,
113(50):E8089-E8095. <a href="https://www.pnas.org/doi/full/10.1073/pnas.1608242113" class="external-link">doi:10.1073/pnas.1608242113</a></p>
<p>Kéfi S., Dakos V., Scheffer M., Van Nes E.H. &amp; Rietkerk, M.
(2013) Early warning signals also precede non-catastrophic transitions.
<em>Oikos</em>, 122: 641-648. <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1600-0706.2012.20838.x" class="external-link">doi:10.1111/j.1600-0706.2012.20838.x</a></p>
<p><br></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Duncan O’Brien, Smita Deb, Sahil Sidheekh, Narayanan Krishnan, Partha Dutta, Christopher Clements.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
